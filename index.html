<!DOCTYPE html>
<html lang="si">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GK ICT Junior Starter Exam Portal</title>
    <!-- Include Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Background Image Styles - Carried over from LMS Login */
        body {
            /* Use a sample URL. You can replace this with your preferred image URL. */
            background-image: url('login_back4.jpg');
            background-size: cover; 
            background-position: center;
            background-attachment: fixed;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh; 
            padding: 1rem;
        }
        
        /* Pseudo-element to apply the blur effect and dark overlay */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: inherit;
            background-size: inherit;
            background-position: inherit;
            background-attachment: inherit;
            filter: blur(8px); 
            background-color: rgba(0, 0, 0, 0.4); /* Darker overlay for better contrast */
            z-index: -1; 
        }

        /* The main content container needs a slightly transparent background to see the blur */
        #authContainer {
            background-color: rgba(255, 255, 255, 0.95); /* Slightly less transparent white */
            backdrop-filter: blur(10px); 
            z-index: 10;
        }

        /* This class is referenced by the JS for strict hiding/showing */
        .hidden-strict {
            display: none !important;
        }

        /* Styles for fade-in/fade-out animation (Modal structure is retained but hidden) */
        .modal-overlay {
            transition: opacity 0.3s ease-out;
        }
        .modal-content {
            transition: transform 0.3s ease-out, opacity 0.3s ease-out;
            transform: translateY(20px); 
            opacity: 0;
        }
        .modal-show .modal-content {
            transform: translateY(0);
            opacity: 1;
        }
    </style>
</head>
<body class="p-4">

    <!-- Auth Container -->
    <div id="authContainer" class="w-full max-w-sm rounded-xl shadow-2xl p-5 md:p-6 mb-8">
        
        <h2 class="text-2xl font-bold text-gray-800 text-center mb-6">GK ICT Exam Portal Login</h2>

        <!-- Form and Message Container -->
        <form id="authForm" class="space-y-4">
            
            <!-- Exam Code Input (Formerly Access Code) -->
            <div class="space-y-1">
                <label for="authAccessCode" class="block text-sm font-medium text-gray-700">Exam Code</label>
                <input type="text" id="authAccessCode" placeholder="Enter Exam Code" required
                       class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-base" />
            </div>
            
            <!-- Submit Button (Login) -->
            <button type="submit" id="authSubmit"
                    class="w-full py-2.5 mt-4 text-white font-semibold rounded-lg transition-colors duration-300 focus:outline-none focus:ring-4 
                           bg-green-600 hover:bg-green-700 focus:ring-green-300">
                Login
            </button>
            
            <!-- Login Status and Clear Button Container (NEWLY ADDED) -->
            <div id="statusContainer" class="mt-4 p-3 bg-blue-50 rounded-lg text-center border border-blue-200">
                <p id="attemptStatus" class="text-sm font-medium text-blue-700 mb-2">Loading...</p>
                <!--button type="button" id="clearCountBtn"
                        class="w-full px-4 py-2 text-sm bg-red-600 hover:bg-red-700 text-white font-medium rounded-lg transition-colors focus:outline-none focus:ring-4 focus:ring-red-300 mt-2">
                    Clear Login Count (ගණන ඉවත් කරන්න)
            </button-->
            </div>

            <!-- Message Area (Used by JS: setMsg) -->
            <div id="authMessage" class="message text-center text-xs font-medium min-h-[20px] pt-1"></div>

        </form>
    </div>
    
    <!-- Footer -->
    <footer id="footerCredit" class="w-full max-w-lg mt-8 text-center text-xs text-gray-200 z-10">
        <!-- Text is made light for better contrast against the darker, blurred background -->
    </footer>


    <!-- JavaScript Logic -->
    <script>
        // MASTER Exam Code - Only this code is required to log in
        const MASTER_EXAM_CODE = "GK11111"; // Hardcoded value for comparison

        // Current Exam Portal Version
        const PORTAL_CURRENT_VERSION = "Exam Portal 1.0"; 
        
        // --- LOCAL STORAGE KEYS & LIMIT (UPDATED/NEW) ---
        const LOGIN_COUNT_KEY = 'GK_ICT_JUNIOR_EXAM'; // Required key for login limit tracking
        const KEY_LOGGED = 'app_logged'; // Existing key, not strictly required for the new logic
        const MAX_ATTEMPTS = 2; // Maximum allowed logins

        // Exam Code Error Message
        const EXAM_CODE_ERROR_MSG = "Invalid Exam Code (වැරදි විභාග කේතය)"; 
        
        // --- NEW: Redirect URL එක මෙතැනින් වෙනස් කළ හැකිය (You can change the Redirect URL here) ---
        const REDIRECT_URL = "ICT_Juniors_Exam.html"; 

        // --- NEW: Class constants for visual state management ---
        const ENABLED_COLOR_CLASSES = 'bg-green-600 hover:bg-green-700 focus:ring-green-300';
        const DISABLED_COLOR_CLASSES = 'bg-gray-400 hover:bg-gray-400 focus:ring-gray-300 cursor-not-allowed';

        // --- NEW: Toggle visibility of the Clear Count Button ---
        const SHOW_CLEAR_COUNT_BUTTON = true; // Set this to 'false' to hide the button.

        //--------------------------------------

        (async function(){
            // --- Utility Functions ---
            function $id(id){ return document.getElementById(id); }
            
            function setMsg(txt, ok=false){
              const el = $id('authMessage');
              el.textContent = txt;
              el.className = 'message text-center text-xs font-medium min-h-[20px] pt-1'; // Reset classes
              if (txt) {
                if(ok){
                  el.classList.add('text-green-700', 'bg-green-100', 'py-1', 'px-2', 'rounded-lg');
                } else {
                  el.classList.add('text-red-700', 'bg-red-100', 'py-1', 'px-2', 'rounded-lg');
                }
              }
            }

            // --- Elements ---
            const form = $id('authForm');
            const inputExamCode = $id('authAccessCode');
            const submitBtn = $id('authSubmit');
            const footerCredit = $id('footerCredit');
            // NEW Elements for the limit feature
            const clearCountBtn = $id('clearCountBtn'); 
            const attemptStatusEl = $id('attemptStatus'); 

            // --- NEW Core Logic ---

            function getLoginCount() {
                // Retrieve count from localStorage, default to 0 if null/invalid
                const count = parseInt(localStorage.getItem(LOGIN_COUNT_KEY), 10);
                return isNaN(count) || count < 0 ? 0 : count;
            }

            function checkLoginLimit() {
                const currentCount = getLoginCount();
                const attemptsLeft = MAX_ATTEMPTS - currentCount;

                if (currentCount >= MAX_ATTEMPTS) {
                    // Disable button and show limit reached message
                    submitBtn.disabled = true;
                    submitBtn.textContent = 'Login Limit Reached (සීමාව ඉක්මවා ඇත)';
                    attemptStatusEl.textContent = `Login Attempts: ${currentCount} / ${MAX_ATTEMPTS} (සීමාවට පැමිණ ඇත)`;
                    
                    // NEW: Apply Gray/Disabled look
                    submitBtn.classList.remove(...ENABLED_COLOR_CLASSES.split(' '));
                    submitBtn.classList.add(...DISABLED_COLOR_CLASSES.split(' '));
                    
                    // If page loads with limit reached, display a warning
                    if (currentCount === MAX_ATTEMPTS) {
                         setMsg("You have reached the maximum login limit (උපරිම ලොග් වීමේ සීමාවට පැමිණ ඇත).", false);
                    }
                } else {
                    // Enable button and show attempts left
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'Login';
                    attemptStatusEl.textContent = `පිවිසිය විය හැකි ගණන: ${attemptsLeft} / ${MAX_ATTEMPTS}`;
                    setMsg(""); // Clear any previous error message on load
                    
                    // NEW: Apply Green/Enabled look
                    submitBtn.classList.remove(...DISABLED_COLOR_CLASSES.split(' '));
                    submitBtn.classList.add(...ENABLED_COLOR_CLASSES.split(' '));
                }
            }
            
            /**
             * සාර්ථක ලොග් වීමකින් පසු වෙනත් පිටුවකට යොමු කිරීම (Real Redirection).
             * (Direct Redirection after successful login.)
             */
            function handleLoginSuccess(identifier) {
                inputExamCode.value = '';
                
                // Redirection එක මෙතැනින් සිදු වේ. (The redirection happens here)
                console.log(`Login successful using Exam Code: ${identifier}. Redirecting to ${REDIRECT_URL}...`);
                
                // මෙම කෝඩ් පේලිය මගින් ඔබගේ නව HTML පිටුවට යොමු කරයි.
                window.location.href = REDIRECT_URL; 
                
                // සටහන: ඔබ මෙය Canvas/Sandbox පරිසරය තුල භාවිතා කරන්නේ නම්, 'Failed to set the 'href' property on 'Location''
                // දෝෂයක් දැකිය හැක. නමුත් මෙය සැබෑ වෙබ් සර්වරයක නිවැරදිව ක්‍රියාත්මක වේ.
            }

            // --- Event Listener for Form Submission ---
            form.addEventListener('submit', async (ev)=>{
              ev.preventDefault();
              submitBtn.disabled = true;
              submitBtn.textContent = 'Logging in...';

              const enteredCode = inputExamCode.value.trim(); 
              
              // 1. Check if the limit has already been reached before attempting login
              if (getLoginCount() >= MAX_ATTEMPTS) {
                  checkLoginLimit(); // Re-validate status
                  setMsg("Login attempts exhausted (ලොග් වීමේ උත්සාහයන් අවසන්).", false);
                  return;
              }

              // 2. Validate if Exam Code is entered
              if(!enteredCode){ 
                setMsg("Exam Code ඇතුළත් කරන්න.");
                submitBtn.disabled = false;
                submitBtn.textContent = 'Login';
                return;
              }

              // 3. Exam Code Validation
              if (MASTER_EXAM_CODE === enteredCode) { 
                // 4. SUCCESS - INCREMENT LOGIN COUNT
                let currentCount = getLoginCount();
                currentCount++;
                localStorage.setItem(LOGIN_COUNT_KEY, currentCount.toString());
                
                // localStorage.setItem(KEY_LOGGED, "true"); // Key from old code, keeping it here for reference but not strictly necessary
                
                // NOTE: Changed message to reflect loading, not redirection
                setMsg("Login successful! Redirecting to Exam Portal...", true);
                
                // Update the status display immediately
                checkLoginLimit(); 
                
                // Transition to Exam UI state - onLoginSuccess වෙනුවට නිවැරදි function එක යෙදීම.
                setTimeout(() => handleLoginSuccess(enteredCode), 500); 
              } else {
                // FAIL - Only display error message if failed, do not increment count
                setMsg(EXAM_CODE_ERROR_MSG);
                submitBtn.disabled = false;
                submitBtn.textContent = 'Login';
              }
            });

            // --- Event Listener for Clear Button (NEWLY ADDED) ---
            clearCountBtn.addEventListener('click', ()=>{
                // Clear the count variable
                localStorage.removeItem(LOGIN_COUNT_KEY);
                
                // Reset and check the new state
                checkLoginLimit();
                // Inform the user
                setMsg("Login count cleared. You now have 2 attempts remaining (ලොග් වීමේ ගණන ඉවත් කරන ලදී).", true);
            });


            function init(){
              inputExamCode.value = '';

              // Set Footer Content
              if (footerCredit) {
                  footerCredit.textContent = `Design by : Gayan Karunathilaka | GK ICT School | Exam Portal 2026 | ${PORTAL_CURRENT_VERSION}`;
              }
              
              // Remove the temporary class added during form submission
              submitBtn.textContent = 'Login'; 

              // NEW: Control visibility of the Clear Count button
              if (!SHOW_CLEAR_COUNT_BUTTON) {
                  clearCountBtn.classList.add('hidden-strict'); 
              } else {
                  clearCountBtn.classList.remove('hidden-strict');
              }
              
              // --- NEW: INITIAL CHECK ---
              checkLoginLimit();
            }
            
            init();

        })();


    // --- 2. F12, Ctrl/Cmd + Shortcuts PREVENTION (කෙටිමං අවහිර කිරීම) ---
    document.addEventListener('keydown', function (e) {
        // F12 key (e.key === 'F12' or e.keyCode === 123)
        if (e.key === 'F12' || e.keyCode === 123) {
            e.preventDefault();
        }
        
        // Ctrl+Shift+I, Ctrl+Shift+J (Windows/Linux) - Developer Tools
        if (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'J')) {
            e.preventDefault();
        }
        
        // Ctrl+U (Windows/Linux) - View Source
        if (e.ctrlKey && e.key === 'U') {
            e.preventDefault();
        }

        // Cmd+Option+I (Mac) - Developer Tools
        if (e.metaKey && e.altKey && e.key === 'I') {
            e.preventDefault();
        }
        
        // Cmd+Option+J (Mac) - Developer Tools
        if (e.metaKey && e.altKey && e.key === 'J') {
            e.preventDefault();
        }
    });

    // --- 3. RIGHT CLICK AND LONG PRESS PREVENTION (Right Click සහ Long Press වැළැක්වීම) ---
    document.addEventListener('contextmenu', function (e) {
        e.preventDefault();
    });
        
    </script>

</body>
</html>



